<!DOCTYPE html><html lang="en"><head><title>lib\html-parsers\home</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../../"><meta name="groc-document-path" content="lib\html-parsers\home"><meta name="groc-project-path" content="lib\html-parsers\home.js"><link rel="stylesheet" type="text/css" media="all" href="../../assets/style.css"><script type="text/javascript" src="../../assets/behavior.js"></script><body><div id="meta"><div class="file-path">lib\html-parsers\home.js</div></div><div id="document"><div class="segment"><div class="code"><div class="wrapper"><span class="hljs-pi">'use strict'</span>

<span class="hljs-keyword">import</span> trumpet <span class="hljs-keyword">from</span> <span class="hljs-string">'trumpet'</span>
<span class="hljs-keyword">import</span> { trumpetInnerText, trumpetClasses } <span class="hljs-keyword">from</span> <span class="hljs-string">'./index'</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>TODO !1: doc et TU</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">wrapperApi</span>) </span>{
  <span class="hljs-keyword">const</span> trumpetParser = trumpet()
  trumpetParser.status = {}</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Master status</p></div></div><div class="code"><div class="wrapper">  trumpetParser.selectAll(<span class="hljs-string">'div#masterStatus &gt; a &gt; span.icon'</span>, trumpetClasses((classes) =&gt; {
    <span class="hljs-keyword">let</span> matches = <span class="hljs-literal">null</span>
    <span class="hljs-keyword">let</span> key = <span class="hljs-literal">null</span>
    <span class="hljs-keyword">let</span> value = <span class="hljs-literal">null</span>
    classes.forEach((element) =&gt; {
      matches = element.match(<span class="hljs-regexp">/icon-(.+)/i</span>)
      <span class="hljs-keyword">if</span> (matches &amp;&amp; matches.length &gt; <span class="hljs-number">0</span>) {
        key = key || matches[<span class="hljs-number">1</span>]
      }
      matches = element.match(<span class="hljs-regexp">/level-([0-9]+)/i</span>)
      <span class="hljs-keyword">if</span> (matches &amp;&amp; matches.length &gt; <span class="hljs-number">0</span>) {
        value = value || matches[<span class="hljs-number">1</span>]
      }
    })
    <span class="hljs-keyword">if</span> (key !== <span class="hljs-literal">null</span> &amp;&amp; value !== <span class="hljs-literal">null</span>) {
      trumpetParser.status[key] = value
    }
  }))</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>User / site info</p></div></div><div class="code"><div class="wrapper">  trumpetParser.select(<span class="hljs-string">'div#userPanel span.site &gt; a'</span>, trumpetInnerText((siteName) =&gt; {
    trumpetParser[<span class="hljs-string">'siteName'</span>] = siteName
  }))</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Alarm status</p></div></div><div class="code"><div class="wrapper">  trumpetParser.select(<span class="hljs-string">'div#dashboard div.widget-protection div#slider_zone'</span>, trumpetClasses((classes) =&gt; {
    <span class="hljs-keyword">if</span> (classes.indexOf(<span class="hljs-string">'seclev1'</span>) !== -<span class="hljs-number">1</span>) {
      trumpetParser.alarm = <span class="hljs-string">'off'</span>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (classes.indexOf(<span class="hljs-string">'seclev2'</span>) !== -<span class="hljs-number">1</span>) {
      trumpetParser.alarm = <span class="hljs-string">'half'</span>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (classes.indexOf(<span class="hljs-string">'seclev4'</span>) !== -<span class="hljs-number">1</span>) {
      trumpetParser.alarm = <span class="hljs-string">'full'</span>
    }
    wrapperApi.persistentStates.alarm.push(trumpetParser.alarm)
  }))</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>TODO !2: all others to parse!</p></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>End of parsing, no need to go further</p></div></div><div class="code"><div class="wrapper">  trumpetParser.selectAll(<span class="hljs-string">'footer'</span>, () =&gt; {
    wrapperApi.persistentStates.status.push(trumpetParser.status)
    trumpetParser.end()
  })

  <span class="hljs-keyword">return</span> trumpetParser
}</div></div></div></div></body></html>